# 《陆地军事塔防》开发计划与技术实现

基于完整GDD的详细技术开发指南，专为抖音小游戏优化。目标：**10-14天solo完成**，使用Godot 4.6.1引擎。

## 🎯 项目目标

- **平台**：抖音小游戏（主包≤4MB，整体≤20MB）
- **目标用户**：碎片时间玩家，单局1-3分钟
- **技术栈**：Godot 4.6.1 + HTML5导出 + 抖音开发者工具
- **美术风格**：16-bit像素风，AI生成SVG矢量图

## 📋 开发前提准备（Day 0）

### 工具安装
1. **Godot 4.6.1** - [godotengine.org](https://godotengine.org/) 下载并安装
2. **抖音开发者工具** - [developer.open-douyin.com](https://developer.open-douyin.com/) 下载V14+
3. **Aseprite** - 像素画制作工具
4. **Leonardo.ai/Ideogram** - AI美术生成工具

### 项目初始化
1. 新建Godot项目：`陆地军事塔防`
2. 设置导出：Project → Export → HTML5
   - Threads: Disabled
   - PCK: Zstd compression
   - 移除不必要的模块

## 🏗️ 技术架构

### Godot节点结构
```
Main (Node2D, CanvasLayer UI)
├── Grid (TileMapLayer, 6x8固定网格)
├── BuildingPool (Node, 预造20个建筑实例)
├── UnitPool (Node, 预造100个单位实例)
├── EnemyPool (Node, 预造50个敌人实例)
├── WaveTimer (Timer, 30秒一波)
├── UILayer (CanvasLayer)
│   ├── GoldLabel (Label)
│   ├── ShopButtons (4个TouchScreenButton)
│   ├── RelicPopup (ColorRect+按钮组)
│   └── PauseBtn (TouchScreenButton)
└── GameManager (Node, AutoLoad全局脚本)
```

### 核心脚本框架

#### GameManager.gd (全局游戏管理)
```gdscript
extends Node

# 游戏状态
var gold: int = 100
var wave: int = 1
var grid: TileMapLayer
var building_pool: Array = []
var unit_pool: Dictionary = {}  # {type: [instances]}

func _ready():
    grid = $Grid
    init_pools()
    $WaveTimer.start(30)

func init_pools():
    # 预造建筑对象池
    for i in 20:
        building_pool.append(preload("res://scenes/Building.tscn").instantiate())

    # 预造单位对象池
    for type in ["infantry", "tank", "artillery"]:
        unit_pool[type] = []
        for i in 50:
            var unit = preload("res://scenes/Unit.tscn").instantiate()
            unit.unit_type = type
            unit_pool[type].append(unit)

func add_gold(amount: int):
    gold += amount
    $UILayer/GoldLabel.text = str(gold)

func spawn_wave():
    var enemy_count = wave * 5
    for i in enemy_count:
        spawn_enemy()
    wave += 1

func spawn_enemy():
    var enemy = preload("res://scenes/Enemy.tscn").instantiate()
    # 设置敌人属性和路径
    add_child(enemy)
```

#### Grid.gd (网格拖拽系统)
```gdscript
extends TileMapLayer

const BUILDING_COSTS = {
    "gold_mine": 50,
    "barracks": 100,
    "cannon_tower": 150,
    "tavern": 200
}

func _input(event):
    if event is InputEventScreenDrag:
        var grid_pos = local_to_map(get_global_mouse_position())
        if can_place_building(grid_pos):
            place_building(get_selected_building_type(), grid_pos)

func can_place_building(pos: Vector2i) -> bool:
    return get_cell_source_id(0, pos) == -1  # 空地检查

func place_building(type: String, pos: Vector2i):
    if GameManager.gold < BUILDING_COSTS[type]:
        return

    set_cell(0, pos, get_building_atlas_id(type), Vector2i.ZERO)
    GameManager.add_gold(-BUILDING_COSTS[type])

    # 激活建筑功能
    match type:
        "gold_mine":
            start_gold_production(pos)
        "barracks":
            start_unit_production(pos, "infantry")
        # ... 其他建筑类型
```

#### Unit.gd (单位合并与战斗)
```gdscript
extends CharacterBody2D

@export var level: int = 1
@export var unit_type: String = "infantry"
@export var speed: float = 50.0
@export var damage: float = 10.0

var target_enemy: Node2D

func _ready():
    update_stats_by_level()

func update_stats_by_level():
    # 根据等级调整属性
    scale = Vector2.ONE * (1.0 + (level - 1) * 0.5)
    damage = damage * pow(2, level - 1)
    speed = speed * (1.0 + (level - 1) * 0.2)

func _physics_process(delta):
    # 自动前进
    velocity.x = speed
    move_and_slide()

    # 寻找目标
    if not target_enemy or not is_instance_valid(target_enemy):
        find_target()

    # 攻击逻辑
    if target_enemy and global_position.distance_to(target_enemy.global_position) < 32:
        attack()

func find_target():
    var enemies = get_tree().get_nodes_in_group("enemies")
    if enemies.size() > 0:
        target_enemy = enemies[0]  # 最近敌人

func attack():
    target_enemy.take_damage(damage)
    # 播放攻击动画
    $AnimatedSprite2D.play("attack")

func merge(other_unit):
    if other_unit.unit_type == unit_type and other_unit.level == level:
        level += 1
        update_stats_by_level()

        # 合并特效
        $MergeParticles.emitting = true
        $AnimationPlayer.play("merge_scale")

        other_unit.queue_free()
```

## 📅 详细开发时间表

### Day 1-2: 项目搭建与核心系统
- **目标**：可运行的基础框架
- **任务**：
  1. 创建Godot项目，设置场景结构
  2. 实现6x8网格系统（TileMapLayer）
  3. 基础UI：金币显示、商店按钮
  4. 触控拖拽输入系统
  5. 对象池系统搭建
- **里程碑**：空场景运行，网格可拖拽

### Day 3-4: 建筑与单位系统
- **目标**：完整的放置和生产系统
- **任务**：
  1. 建筑放置逻辑（4种建筑）
  2. 金币生产系统（定时产金）
  3. 单位生产系统（兵营产兵）
  4. 基础单位移动和渲染
  5. 相邻建筑Buff系统
- **里程碑**：建筑可放置并产出资源

### Day 5-6: 合并机制与战斗
- **目标**：核心爽点实现
- **任务**：
  1. 单位拖拽合并系统（Area2D碰撞检测）
  2. 合并视觉特效（缩放+粒子）
  3. 自动战斗系统（单位vs敌人）
  4. 3兵种克制机制
  5. 敌人AI和寻路
- **里程碑**：拖拽2个1级单位合成2级，战斗杀敌

### Day 7-8: 波次与Roguelike
- **目标**：完整的游戏循环
- **任务**：
  1. 波次生成系统（敌人波）
  2. 胜利/失败判定
  3. 遗物选择系统（8种遗物）
  4. 指挥官切换（3种被动）
  5. 随机地貌影响
- **里程碑**：20波通关，选遗物生效

### Day 9-10: 美术与优化
- **目标**：完整的视觉体验
- **任务**：
  1. 导入美术资源（SVG→SpriteFrames）
  2. 动画系统（2帧逐帧）
  3. 粒子效果（合并、战斗）
  4. 音效集成（可选）
  5. 性能优化（对象池、MultiMesh）
- **里程碑**：总资源<1MB，60FPS运行

### Day 11-12: 导出与发布准备
- **目标**：抖音小游戏就绪
- **任务**：
  1. HTML5导出配置（分包策略）
  2. 抖音开发者工具集成
  3. 包大小优化（<4MB主包）
  4. 自审报告编写
  5. 真机测试
- **里程碑**：开发者工具预览正常

### Day 13-14: 最终测试与提交
- **目标**：成功发布
- **任务**：
  1. 完整游戏流程测试
  2. 平衡性调整（Excel表格）
  3. Bug修复
  4. 提审资料准备
  5. 提交审核等待
- **里程碑**：审核通过，上线运行

## 🔧 技术优化方案

### 包大小优化
| 优化项目 | 目标 | 技术方案 |
|---------|------|----------|
| 主包大小 | <4MB | SVG矢量图 + 分包加载 |
| 美术资源 | <500KB | AI生成16-bit像素风格 |
| 代码大小 | <300KB | GDScript TreeShaking |
| 加载时间 | <2秒 | 懒加载 + 对象池 |

### 性能优化
- **渲染**：MultiMeshInstance2D批量渲染单位
- **内存**：对象池复用，及时清理
- **FPS**：固定60FPS，禁用不必要模块
- **触控**：TouchScreenButton + 拖拽优化

## 📱 抖音发布流程

1. **开发者平台注册**：个人/企业认证（1天）
2. **项目创建**：选择"抖音小游戏" + Godot引擎
3. **信息完善**：名称、简介、图标设置
4. **导出导入**：Godot HTML5 → 开发者工具
5. **分包配置**：主包代码/UI，分包资源
6. **自审提交**：按模板填写，突出玩法特色
7. **审核等待**：1-7天，通过后自动上线

## 🎯 风险控制

- **审核风险**：避免敏感词，突出"合并推土机"爽点
- **性能风险**：预留50%单位上限，优先保证60FPS
- **大小风险**：美术使用SVG，代码精简
- **兼容风险**：测试各种机型，适配触控操作

## 📊 平衡设计

使用Excel表格管理：
- **单位属性**：HP/伤害/速度随等级指数增长
- **波次难度**：敌人数量=波数×5，属性递增
- **遗物效果**：+20-50%属性提升
- **建筑效率**：相邻Buff+20%，连锁反应

---

**开发总时长**：35-40小时（兼职1-2周）
**预算**：0元（免费工具）
**成功标准**：20波通关<3分钟，合并特效爆炸

开始开发，目标是抖音小游戏月入过万！🚀